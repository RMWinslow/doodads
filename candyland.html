<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {margin: 0;}    h3 {margin-top:0;}
    dt {font-weight: bold;}    dl,dd {font-size: .9rem;}    dd {margin-bottom: 1em;}
    main{display:flex; flex-wrap: wrap;}
    svg {background-color:#F002; flex: 2 200px; }
    div {padding:1rem; flex: 3 20rem; min-height: 120vh;}
</style>
<!--This is a webpage implementation of the Massive Community Hexcrawl, orchestrated by Skerples.CC BY-NC-SA 4.0, etc.
You can find the original files here: https://coinsandscrolls.blogspot.com/2021/01/osr-massive-community-hexcrawl-complete.html
This file is completely standalone, so you can just save itas a .html and edit it in a text editor.-->

<main>
    <!--This is where all the pretty pictures will go. Map in the hexCanvas Group, position indicator in the highlightCanvas group, so it's always on top.-->
    <svg viewBox="0 0 10000 1" id="mysvg" preserveAspectRatio="xMidYMin meet">
        <g id="hexCanvas"></g>
        <g id="highlightCanvas"></g>
    </svg>
    <!--This is where the text will go.-->
    <div id="textHolder">Click on a hex.</div>
</main>

<script>
    //‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®
    //=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
    //Map Info
    //The Object below is what you want to modify in order to tweak the map content
    //=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
    //‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®
    
    var hexMap = {
        numColumns:5,
        numRows:4,
        landformColors: {
            "Syrup Swamp": "#ffdb8c",
            "Frosty Forest": "MintCream",
            "Amorphous Mountains": "#7B3F00", 
            "Sweet Steppe": "PeachPuff",
            //https://encycolorpedia.com/bb9351, https://encycolorpedia.com/ffdb8c
        },
        factionColors: {
            "Neutral": "black",
            "Kalawi Tribe": "Purple",
            "Researchers": "Green",
            "Rust Monks": "	#B7410E",
            "Protean Army": "#0F52BA",
            "Pallid Knights": "White",
            "Bubblegum Dynasty": "White",
            "None": "#0000",
        },
        hexes: [
            {col:1, row:1, id:"hex1.1", faction:"Bubblegum Dynasty", landform:"Syrup Swamp", 
                terrainFeature: "Gray and rust-orange dirt, sickly brown grass. Metal beams protrude.  ", 
                obviousFeature: "Bands of eyeless purple- hued humans build small settlements. Will  trade warily, listen cautiously, speak rarely. ", 
                hiddenFeature: "The crater-tomb of the Water That Eats. Sacrificing a friend or love one to it grants a boon, often tainted. ", 
            },
            {col:1, row:2, id:"hex1.2", faction:"None", landform:"Sweet Steppe", 
                terrainFeature: "Laminated layers of pristine volcanic glass, as if newly cooled. ", 
                obviousFeature: "Burbling volcanic pit, ringed by smooth metal gantries and floating wires. ", 
                hiddenFeature: "Slug-like magma sprites, jealous of their hidden mineral wealth. They swim through stone. ", 
                symbol: "üêÄ",
            },
            {col:1, row:3, id:"hex1.3", faction:"Rust Monks", landform:"Frosty Forest", 
                terrainFeature: "Hoodoo-lined cliff walls of banded ochre and ebon sandstone. ", 
                obviousFeature: "Cliff-dwellings with windows and eaves designed to 'sing' in the west wind with a meditative drone. ", 
                hiddenFeature: "Collections of mica-leaf volumes etched in alien tongues. Burned translation notes, signs of hasty flight. ", 
            },
            {col:1, row:4, id:"hex1.4", faction:"Pallid Knights", landform:"Amorphous Mountains", 
                terrainFeature: "Angular shards of granite and basalt. Eerie hard-light shadows. ", 
                obviousFeature: "The Starlight Cathedral. Motes of starlight trapped to form windows, arches, pews. ", 
                hiddenFeature: "Pieces of iridescent weightless mirrors, accidentally created. They only reflect the truth. ", 
            },
            {col:2, row:1, id:"hex2.1", faction:"Rust Monks", landform:"Sweet Steppe", 
                terrainFeature: "Dry creek bed. Pockets of sticky liquid seep up and evaporate. ", 
                obviousFeature: "Suspended mesh parabolic dish, manoeuvred by wires and cranks. Twanging wires, creaking metal.  ", 
                hiddenFeature: "Fuschiagogue sky- prophet in monitoring dome, directs dish  operations, breeds winch-finches. ", 
            },
            {col:2, row:2, id:"hex2.2", faction:"Neutral", landform:"Sweet Steppe", 
                terrainFeature: "Salt-crusted dunes, scattered patches of red moss. ", 
                obviousFeature: "Huge hole in the ground, reflective green smoke billowing out of it. It drifts a long way before dissipating. ", 
                hiddenFeature: "At the bottom lies an ancient wurm corpse, slowly expelling clouds of acidic gas. Its eye is valuable. ", 
            },
            {col:2, row:3, id:"hex2.3", faction:"Rust Monks", landform:"Frosty Forest", 
                terrainFeature: "Sharp, jutting cliffs covered in artificial tessellations. ", 
                obviousFeature: "Watercarved stair winds up a cliff. Small niches hold meditating monks, watching the sky for rain. ", 
                hiddenFeature: "Every fifth alcove hides a rusted lever. Together they control the cliffs‚Äô patterns. Potentially a weapon. ", 
            },
            {col:2, row:4, id:"hex2.4", faction:"Pallid Knights", landform:"Amorphous Mountains", 
                terrainFeature: "Jagged peaks capped with asbestos snow. ", 
                obviousFeature: "The Elevenfold Table, a monolithic construct on a flattened peak. Ringed by stairs, decrepit bridges. ", 
                hiddenFeature: "By the light of the moon, the shades Elevenfold Knights test new applicants and perhaps answer questions. ", 
            },
            {col:3, row:1, id:"hex3.1", faction:"Neutral", landform:"Sweet Steppe", 
                terrainFeature: "Jagged limestone outcrops. Few plants larger than lichen. ", 
                obviousFeature: "A single bristlecone pine, twisted by wind. Unreachable, always seems to be visible in the distance. ", 
                hiddenFeature: "A rock shelter, scratched with the names and portraits of people who have slept their. ", 
            },
            {col:3, row:2, id:"hex3.2", faction:"Neutral", landform:"Sweet Steppe", 
                terrainFeature: "Huge turtle shells lined with glimmering stars and old skulls. ", 
                obviousFeature: "City of mobile lights inside a shell. Pool in centre grants one wish per century. Time flows oddly. ", 
                hiddenFeature: "Sleeping void-clad corpse of a fallen starchild. White-furred ratman lives in its heart. ", 
            },
            {col:3, row:3, id:"hex3.3", faction:"Pallid Knights", landform:"Frosty Forest", 
                terrainFeature: "Steep canyons, steam leaking from sulphur-stained walls. ", 
                obviousFeature: "Floating pumice-island drifts. Monkey-like ghosts dart out of holes, try to steal organs. ", 
                hiddenFeature: "Island contains alcoves full of decorated brittle armour, coated in a mineral crust. ", 
            },
            {col:3, row:4, id:"hex3.4", faction:"Neutral", landform:"Amorphous Mountains", 
                terrainFeature: "Jagged cliffs. Between them, craters filled with black glass. ", 
                obviousFeature: "A north-south pass.  Heavily fortified trading post run by mind- addled ex-Researcher.  ", 
                hiddenFeature: "A buried titan, dreaming. Nightmares manifest as solid shadows, hostile to all, but particularly Pallid Knights. ", 
            },
            {col:4, row:1, id:"hex4.1", faction:"Protean Army", landform:"Frosty Forest", 
                terrainFeature: "Oily rivulets bounded by yellow- streaked crumbling cliff faces.  ", 
                obviousFeature: "Metal-meat hybrid transport barracks halted for repairs. Wild animals fight nearby for cast-off scraps. ", 
                hiddenFeature: "A wurm nest lies calcified in a rock formation. It‚Äôs petrified occupants will reawaken if the area floods. ", 
            },
            {col:4, row:2, id:"hex4.2", faction:"Researchers", landform:"Frosty Forest", 
                terrainFeature: "Square-cut cliffs, right-angle rivulets of murky water.  ", 
                obviousFeature: "Broken golem factory- complex. Shattered ceramic orbs, maze of  conveyor belts and rusted arms. ", 
                hiddenFeature: "Golem-mine and geothermal magic loop in the bowels of the complex. Parasitic Researcher team. ", 
            },
            {col:4, row:3, id:"hex4.3", faction:"Protean Army", landform:"Amorphous Mountains", 
                terrainFeature: "Desolate plateau, narrow arch bridges over dizzying chasms. ", 
                obviousFeature: "Camp of Proteans preparing to assault the Pallid keep in 4.4. Scouts, spies, and siege engines. ", 
                hiddenFeature: "Ruins of a lost city in the depths of the canyons, wreathed in toxic fog. Cursed weapons of ancient power. ", 
            },
            {col:4, row:4, id:"hex4.4", faction:"Pallid Knights", landform:"Amorphous Mountains", 
                terrainFeature: "Windswept hills of stone and moss, small ponds scattered throughout. ", 
                obviousFeature: "A keep with a high tower perched atop a rocky crag. A ghostly call draws creatures from miles around. ", 
                hiddenFeature: "Warrens of tunnels and tombs below the keep hold the remains (and spirits) of the Pallid Knights. ", 
            },
            {col:5, row:1, id:"hex5.1", faction:"Neutral", landform:"Sweet Steppe", 
                terrainFeature: "Huge strip mine canyon. Stepped sides, heaps of spoil, fallen cables. ", 
                obviousFeature: "Cracked titan bones at the mine‚Äôs floor, leaking regenerating marrow from churning extraction plants. ", 
                hiddenFeature: "Buried marrow-vats, a small ocean of protein, awaiting the arrival of long-dead owners. ", 
            },
            {col:5, row:2, id:"hex5.2", faction:"Pallid Knights", landform:"Frosty Forest", 
                terrainFeature: "Pale granite slopes, blending into each other and concealing deep chasms. ", 
                obviousFeature: "Ghostly fortified tower collapses at sunrise, reassembles itself in reverse each sunset. ", 
                hiddenFeature: "Time-crypts of the Pallid Knights, where their greatest warriors rest and wait for the end of time. ", 
            },
            {col:5, row:3, id:"hex5.3", faction:"Rust Monks", landform:"Amorphous Mountains", 
                terrainFeature: "High hill surrounded by tar pits and rivers. Leafless trees. ", 
                obviousFeature: "Walled monastery, bearded monks. Everything made from wood and stone. ", 
                hiddenFeature: "Shrine containing the coagulated soul of a wurm matriarch. Guarded by eight servitor-golems. ", 
            },
            {col:5, row:4, id:"hex5.4", faction:"Rust Monks", landform:"Frosty Forest", 
                terrainFeature: "Calderas of geothermally heated water form steep cascades. ", 
                obviousFeature: "Weathered stone monastery. Monks offer hospitality but slay those who find the tower. ", 
                hiddenFeature: "Beyond the path from the monastery, a tower of alien metal, infinitely tall. Unseen from a distance. ", 
            },
            //The rest are a test of bordering placeholder hexes.
        ],
        borderHexes: [
            {col:1, row:0,  landform:"Syrup Swamp", },
            {col:2, row:0,  landform:"Syrup Swamp", },
            {col:3, row:0,  landform:"Syrup Swamp", },
            {col:4, row:0,  landform:"Frosty Forest", },
            {col:5, row:0,  landform:"Frosty Forest", },

            {col:1, row:5,  landform:"Syrup Swamp", },
            {col:2, row:5,  landform:"Syrup Swamp", },
            {col:3, row:5,  landform:"Amorphous Mountains", },
            {col:4, row:5,  landform:"Frosty Forest", },
            {col:5, row:5,  landform:"Frosty Forest", },

            {col:0, row:0,  landform:"Frosty Forest", },
            {col:0, row:1,  landform:"Frosty Forest", },
            {col:0, row:2,  landform:"Frosty Forest", },
            {col:0, row:3,  landform:"Frosty Forest", },
            {col:0, row:4,  landform:"Amorphous Mountains", },
            {col:0, row:5,  landform:"Frosty Forest", },

            {col:6, row:0,  landform:"Frosty Forest", },
            {col:6, row:1,  landform:"Frosty Forest", },
            {col:6, row:2,  landform:"Frosty Forest", },
            {col:6, row:3,  landform:"Amorphous Mountains", },
            {col:6, row:4,  landform:"Frosty Forest", },
            {col:6, row:5,  landform:"Frosty Forest", },
        ],
        encounters: {
            "Syrup Swamp": [
                {
                    omen:"",
                    event:"",
                },
            ],
            "Frosty Forest": [
                {
                    omen:"",
                    event:"",
                },
            ],
            "Amorphous Mountains": [
                {
                    omen:"",
                    event:"",
                },
            ],
            "Sweet Steppe": [
                {
                    omen:"",
                    event:"",
                },
            ],
        }
    }
    
</script>




































<!--The rest of this file is just janky code to turn the list into an interactive map. You hopefully don't need to touch any of this stuff.-->
<script>
    //define the parameters for the hex map.
    var numColumns = hexMap.numColumns;
    var numRows = hexMap.numRows;
    var hexOuterRadius = 30; 
    var hexInnerRadius = hexOuterRadius * Math.sqrt(3)/2; 
    var marginSize = hexOuterRadius / 5;
    
    //calculate internal dimensions of map, assuming hexes are oriented with flat side on top.
    var totalWidth = hexOuterRadius * (numColumns*1.5 + 0.5); 
    var totalheight = hexInnerRadius * (2 * numRows + 1);

    //set up the svg to use as a canvas
    var canvas = document.getElementById("hexCanvas");
    //scale the svg height to the window height. I dunno. I think it looks nice that way. Will probably look turbo janky on mobile. Note the body {margin: 0;} up top that makes this work.
    //canvas.setAttribute("height", window.innerHeight);
    //Fiddle with the interior dimensions of the svg to make it the right size for the hex grid. margin around the edges
    document.getElementById("mysvg").setAttribute("viewBox", "-"+marginSize+" -"+marginSize+" " + (totalWidth+2*marginSize) + " " + (totalheight+2*marginSize));

    //------------------------------------
    // Functions for building the map
    //------------------------------------
    
    function addToCanvas(addedContent) {
        //This function just takes a string and appends it to the inside of the canvas svg.
        canvasContent = canvas.innerHTML;
        canvas.innerHTML += addedContent;
    }

    function translatePoint(x,y,theta,r) {
        //a snippet of math I use to build the points of a hex by moving out from the center at different angles.
        newy = y+r*Math.sin(theta);
        newx = x+r*Math.cos(theta);
        return [newx,newy];
    }
    function createHexagon(x,y,r,fill,stroke, id){
        //base angle and incremental angle. Changing ba to PI/6 will orient the hex with pointy side up. 
        var ba = 0;
        var ia = Math.PI/3;
        //find vertices
        var vertices = [];
        for (var i = 0; i < 6; i++) { 
            vertices[i] = translatePoint(x,y,ba+i*ia,r);
        }
        //translate all this info into svg format.
        var svgHex = `<polygon points="POINTSPLACEHOLDER" fill="FILLPLACEHOLDER" stroke="STROKEPLACEHOLDER" id="IDPLACEHOLDER"/>`;
        svgHex = svgHex.replace("POINTSPLACEHOLDER",vertices.join());
        svgHex = svgHex.replace("FILLPLACEHOLDER",fill);
        svgHex = svgHex.replace("STROKEPLACEHOLDER",stroke);
        svgHex = svgHex.replace("IDPLACEHOLDER",id);
        return svgHex;
    }
        
    function createText(x,y,h,fill, stroke, text){
        var svgText = `<text x="XPLACEHOLDER" y="YPLACEHOLDER" 
            dominant-baseline="middle" text-anchor="middle" 
            style="font-family: sans-serif;" font-size="FONTSIZEPLACEHOLDER" font-weight="bold"
            fill="FILLPLACEHOLDER" 
            stroke="STROKEPLACEHOLDER" stroke-opacity="0" stroke-width="0.3">
                TEXTPLACEHOLDER
            </text>`;
        var svgText = `<foreignObject x="XPLACEHOLDER" y="YPLACEHOLDER" width="WIDTHPLACEHOLDER" height="20">
                <div style="color: FILLPLACEHOLDER; text-align:center; padding:0; font-family: sans-serif; font-size:FONTSIZEPLACEHOLDERpx; font-weight:bold;">
                    TEXTPLACEHOLDER
                </div>
            </foreignObject>`;
        svgText = svgText.replace("XPLACEHOLDER",x-hexInnerRadius);
        svgText = svgText.replace("YPLACEHOLDER",y);
        svgText = svgText.replace("WIDTHPLACEHOLDER",hexInnerRadius*2);
        svgText = svgText.replace("FILLPLACEHOLDER",fill);
        svgText = svgText.replace("STROKEPLACEHOLDER",stroke);
        svgText = svgText.replace("FONTSIZEPLACEHOLDER",h);
        svgText = svgText.replace("TEXTPLACEHOLDER",text);
        return svgText;
    } 

    function createHexGroup(hex) {
        //pass in a hex object from the hexMap definition way up top, and this will convert it into an svg group form.
        //first, do some math to figure out the centerpoint of the hex
        hexX = hexOuterRadius * (1.5 * hex.col - 0.5);
        hexY = hexInnerRadius * (2 * hex.row - hex.col % 2);
        //now do some syntax shenanigans to build a group with background, coordinate text, and faction text, etc.
        //We need to group it so that we can respond to clicks on the enter thing
        svgGroup = `<g id="`+hex.id+`" onClick="clickHex(this.id)">`
        svgGroup += createHexagon(hexX,hexY,hexOuterRadius,hexMap.landformColors[hex.landform],"black", hex.id);
        svgGroup += createText(hexX,hexY-hexInnerRadius*0.4,hexOuterRadius*0.6,hexMap.factionColors[hex.faction], "black", hex.col+"."+hex.row);
        svgGroup += createText(hexX,hexY+hexInnerRadius*0.3,hexOuterRadius*0.2,hexMap.factionColors[hex.faction], "none", hex.faction);
        if (hex.symbol){
            svgGroup += createText(hexX,hexY-hexInnerRadius*0.8,hexOuterRadius*0.3,hexMap.factionColors[hex.faction], "none", hex.symbol);
        }
        svgGroup += `</g>`;
        return svgGroup;
    }

    function createBlankHex(hex) {
        //pass in a hex object from the hexMap definition way up top, and this will convert it into an svg group form.
        //first, do some math to figure out the centerpoint of the hex
        hexX = hexOuterRadius * (1.5 * hex.col - 0.5);
        hexY = hexInnerRadius * (2 * hex.row - hex.col % 2);
        //now draw a blank hex
        svgGroup = `<g>`
        svgGroup += createHexagon(hexX,hexY,hexOuterRadius,hexMap.landformColors[hex.landform],"#0000", hex.id);
        svgGroup += `</g>`;
        return svgGroup;
    }

    //------------------------------------
    // Now we actually build it.
    //------------------------------------

    for (var hex of hexMap.borderHexes){addToCanvas(createBlankHex(hex));}

    for (var hex of hexMap.hexes){
        addToCanvas(createHexGroup(hex));
    }


    //------------------------------------
    // Handle clicks on the hexes.
    //------------------------------------

    function rD(i){return i[Math.floor(Math.random()*i.length)];}

    function clickHex(hexID){
        hex = hexMap.hexes.filter(function(hex){return hex.id == hexID})[0];//sorry
        console.log(hex);

        textHolder = document.getElementById("textHolder");

        textContent = `<h3>HEADERPLACEHOLDER</h3>
                        <dl>
                            <dt>Terrain:</dt>
                            <dd>TERRAINPLACEHOLDER</dd>
                            <dt>Obvious Feature:</dt>
                            <dd>OBVIOUSPLACEHOLDER</dd>
                            <dt>Hidden Feature:</dt>
                            <dd>HIDDENPLACEHOLDER</dd>
                        </dl>
                        <hr>
                        <h3>Random Encounter:</h3>
                        <dl>
                            <dt>Omen:</dt>
                            <dd>OMENPLACEHOLDER</dd>
                            <dt>Encounter:</dt>
                            <dd>ENCOUNTERPLACEHOLDER</dd>
                        </dl>
                        `;
        textheader =  hex.col+"."+hex.row+" - "+hex.faction+" - "+hex.landform;
        textContent = textContent.replace("HEADERPLACEHOLDER",textheader);
        textContent = textContent.replace("TERRAINPLACEHOLDER",hex.terrainFeature);
        textContent = textContent.replace("OBVIOUSPLACEHOLDER",hex.obviousFeature);
        textContent = textContent.replace("HIDDENPLACEHOLDER",hex.hiddenFeature);

        encounterdraw = rD(hexMap.encounters[hex.landform]);
        textContent = textContent.replace("OMENPLACEHOLDER",encounterdraw.omen);
        textContent = textContent.replace("ENCOUNTERPLACEHOLDER",encounterdraw.event);

        textHolder.innerHTML = textContent;

        //this adds a little outline to the most recently clicked hex.
        //The svg up above has a seperate group that's always on top of the canvas to make this work.
        hexX = hexOuterRadius * (1.5 * hex.col - 0.5);
        hexY = hexInnerRadius * (2 * hex.row - hex.col % 2);
        document.getElementById("highlightCanvas").innerHTML = createHexagon(hexX,hexY,hexOuterRadius*1.1,"none","black", hex.id);
    }

</script>

<!--Here's an implementation of a similar concept using an actual canvas element: https://www.rareese.com/blog/hexagonjs-->


